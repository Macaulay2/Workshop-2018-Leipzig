\documentclass[11pt]{amsart}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{graphicx,epsfig}
\usepackage{enumerate}
\usepackage{xypic}
\usepackage{tikz}
\usepackage{csquotes}
\usepackage{multicol}
\usepackage{hyperref}
%\usepackage{times}  
\usetikzlibrary{calc}
  \input{xy}
  \xyoption{all}
\usepackage{url}
\usepackage[]{algorithm2e}
\setlength{\oddsidemargin}{0.0in}
\setlength{\evensidemargin}{0.0in}
\setlength{\textwidth}{6.5in}
\setlength{\parskip}{0.15cm}
\setlength{\parindent}{0.5cm}

\DeclareMathOperator{\reg}{reg}
\DeclareMathOperator{\proj}{proj}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\spec}{spec}
\DeclareMathOperator{\tor}{Tor}
\DeclareMathOperator{\Mat}{Mat}
\DeclareMathOperator{\Ima}{Im}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Z}{\mathbb{Z}}
\DeclareMathOperator{\N}{\mathbb{N}}
\DeclareMathOperator{\p}{\mathfrak{p}}
\DeclareMathOperator{\Stab}{Stab}
\DeclareMathOperator{\Supp}{ Supp}
\DeclareMathOperator{\en}{end}
\DeclareMathOperator{\maxdegree}{maxdegree}



\newtheorem{thm}{Theorem}[section]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{coro}[thm]{Corollary}
\newtheorem{conjecture}[thm]{Conjecture}
\theoremstyle{definition}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{notation}[thm]{Notation}
\newtheorem{thmdef}[thm]{Theorem-Definition}
\newtheorem{rem}[thm]{Remark}
\newtheorem{remdef}[thm]{Remark-Definition}
\newtheorem{example}[thm]{Example}
\newtheorem{exercise}[thm]{Exercise}
\newtheorem{question}[thm]{Question}

\begin{document}

\title[LinearTruncations.m2]{Linear Truncations Package in Macaulay 2} 
\author{David Eisenbud}
\address{Department of Mathematics, University of California at Berkeley and the Mathematical Sciences Research Institute, Berkeley, CA 94720, USA}
\email{de@msri.org}
\author{Navid Nemati}
\address{ Universit\'{e} ́ C\^{o}te d'Azur, Inria, 2004 route des Lucioles, 06902 Sophia Antipolis, France}
\email{navid.nemati@inria.fr}


\begin{abstract}
 We introduce a  Macaulay2 package, entitled \textit{linearTruncations}, which computes the multigraded truncations that give linear resolutions.
\end{abstract}

\maketitle
\section{Introduction}

\noindent Castelnuovo-Mumford regularity is a fundamental invariant in commutative algebra and algebraic geometry. Roughly speaking, it measures the complexity of a module or a sheaf. Let $S$ be a polynomial ring with a standard grading and $M$ be a finitely generated $S$-module. In this case, the two most popular definitions of Castelnuovo-Mumford regularity are the one in terms of graded Betti numbers and the one using the local cohomology. It is proved in \cite{EisenbudGoto} that the Castelnuovo-Mumford regularity is the smallest number where the truncation of the module has a linear resolution. A multigraded extension of Castelnuovo-Mumford  was first introduced by Hoffman and Wang in a special case \cite{HoffmanWang}, and later by Maclagen and Smith \cite{MaclagenSmith} and Botbol and Chardin in a more general setting \cite{BotbolChardin}. An interesting question is to ask about the relation between Castelnuovo-Mumford regularity of $M$ in the multigraded case and the degrees $\textbf{d}$ where the truncation $M_{\geq \textbf{d}}$ has a linear resolution.  Note that, If $M_{\textbf{d}}$ has a linear resolution (as a standard graded module), so does $M_{\textbf{d}'}$  for all $\textbf{d}'\geq \textbf{d}$. Therefore these multidegrees form a region, and we call it \textit{linear truncations}. Also, it is enough to find  the minimal generators for the region where the truncation has a linear resolution. This article introduces the \textit{linearTruncations} package for \cite{M2}, which provides tools for constructing and studying linear truncations.




The first question is to show the linear truncations is a non-empty set.  In  \autoref{Section Theorems}, we will provide an answer to this question. Indeed, in  \cite{EisenbudErmanSchreyer}  the authors provide a degree $\textbf{d}$  where $M_{\geq \textbf{d}}$ has a linear resolution. Unfortunately, this degree, in general,  is greater than the generators of the linear truncations. Moreover, we refine this theorem and give a better bound in the bigraded case in Theorem \autoref{r=2}. By using these two results, we describe the main code in this package $(\mathtt{findAllLinearTruncations}$), which finds all the generators of the linear truncations.   In the last section, we provide some examples and give an answer to some questions  that may arise about linear truncations. 

\section{Linear Truncations: \\ $\mathtt{coarseMultigradedRegularity}$ and  $\mathtt{findAllLinearTruncations}$ }\label{Section Theorems}
\noindent Throughout, we shall use the following notations. Let $k$ be a field and $S=k[x_1,\dots ,x_n]$ be a $\Z^r$-graded polynomial ring over $k$. Let $M$ be a finitely generated $S$-module, let $\textbf{d}=(d_1,\dots,d_r)\in \Z^r$, define $\bar{\textbf{d}}=d_1+\cdots +d_r$ to be the total degree of $\textbf{d}$ and  $M_{\geq \textbf{d}}:= \oplus _{\textbf{d}'\geq \textbf{d}} M_{\textbf{d}'}$ is the truncation of $M$ at $\textbf{d}$. 
 We define the \textit{linear truncations} of $M$ to  be 
 $$
 \{ \textbf{d} \in \Z^r \mid M_{\geq \textbf{d}} \,\text{has a linear resolution}\}\subset \Z^r.
 $$
As we mentioned before, in \cite{EisenbudErmanSchreyer} the authors prove that the linear truncations is a non-empty set.
 \begin{prop}\cite[Proposition 1.7 ]{EisenbudErmanSchreyer}\label{prop EES}
 Let $M$ be finitely generated $\Z^r$-graded $S$-module. Suppose $M$ has a finite free multi-homogeneous resolution
 $$
 0\leftarrow M\leftarrow G_0\leftarrow G_1\leftarrow \cdots \leftarrow G_N\leftarrow 0.
 $$
 Write $G_k= \oplus S(-\textbf{a})^{\beta_{k,\textbf{a}}}$ and set $b_i = \max \{ a_i \mid \exists \beta_{k,\textbf{a}}\neq 0 \}$ and $\textbf{b}=(b_1,\dots,b_r)$, then $M_{\geq \textbf{b}}$ has a linear resolution.
 \end{prop}
The code $\mathtt{CoarseMultigradedRegularity}$ in the package is implemented to find an element in the linear truncations of a finitely generated module. While $r\geq 3$, this code is implemented by using  Proposition \autoref{prop EES}.

  \begin{footnotesize}
 \begin{verbatim}
i0 : S=QQ[x,y,z,Degrees=>{{1,0,0},{0,1,0},{0,0,1}}];
i1 : I=ideal(x*y*z, x*y^2, y*z^2);
i2 : M=S^1/I;
i3 : coarseMultigradedRegularity M
o3 : {1, 2, 2}
\end{verbatim}
\end{footnotesize}
In  the above example one can check that truncation of $M$ at $(0,0,2), (0,1,1), (1,0,1) $ and $(1,1,0)$ has a linear resolution. 

\subsection*{Bigraded Case} In this part, let $S=k[x_1,\dots,x_n,y_1,\dots,y_m]$ be a polynomial ring and $\deg(x_i)=(1,0)$ and $\deg(y_i)=(0,1)$.   for any $\textbf{d}\in \Z^2$ we have
$$
0\rightarrow M_{\geq \textbf{d}} \rightarrow M\rightarrow E\rightarrow 0,
$$
where $E= M/M_{\geq \textbf{d}}$. The above short exact sequence yields the following long exact sequence on $\Tor$ modules
$$
\cdots \rightarrow \Tor_{i+1}^S(M,k)\rightarrow \Tor_{i+1}^S(E,k)\rightarrow 
\Tor_i^S({M_{\geq \textbf{d}}},k)\rightarrow \Tor_i^S(M,k)\rightarrow \cdots .
$$
Therefore, vanishing of $\tor_i^S(M_{\geq \textbf{d}},k)$ in degree $\mu$ is deduced by vanishing of $\tor_i^S(M,k)$ and $\tor_{i+1}^S(E)$ in that degree. 
\begin{dfn}
Let $M$ be a finitely generated bigraded $S$-module. Define
\begin{align*}
b_i^x(M) &:= \max \lbrace p \vert \, \exists \,q \,;\,  \tor_{i}^S(M,k)_{p,q}\neq 0\rbrace = \max \lbrace p \vert \tor_i^S(M, k[y])_{(p,\star)\neq 0}\rbrace\\
b_i^y(M) &:= \max \lbrace q \vert \, \exists \,p \,;\, \tor_{i}^S(M,k)_{p,q}\neq 0\rbrace= \max \lbrace q \vert \tor_i^S(M, k[x])_{(\star,q)\neq 0}\rbrace.
\end{align*}
The partial regularities of $M$ up to $i$-th step are defined as follows:
$$
\reg^i _x(M) := \max_{j\leq i} \lbrace b_j^x(M)-j\rbrace, \reg^i_y(M) = \max_{j\leq i}\lbrace b_j^y(M)-j\rbrace;
$$
and  the partial regularities of $M$ are:
$$
\reg _x(M) := \max_{j} \lbrace b_j^x(M)-j\rbrace, \reg_y(M) = \max_{j}\lbrace b_j^y(M)-j\rbrace.
$$
\end{dfn}
\begin{thm}\label{r=2}
Let $S=k[x_1,\dots,x_n,y_1,\dots, y_m]$ be a bigraded polynomial ring and $M$ be a finitely generated bigraded $S$-module.  Let $\textbf{d}\in \Z^2$, if $\bar{\textbf{d}}\geq \reg(M)$ and $ \textbf{d} \geq  (\reg^t_x(M),\reg^t_y(M))$, then  
$M_{\geq \textbf{d}}$ has a linear resolution for $t$ steps. In particular, truncation of $M$ at $(\reg_x(M),\reg_y(M))$ has a linear resolution.
\end{thm}


\begin{proof}
For simplicity, we replace $M$ with $M(\textbf{d})$ and we show $M_{\geq 0}$ has a linear resolution.

We have $\tor_i^S(M,k)_{(a,b)}=0$ for any $a>0$ or $b> 0$ and $i\leq t$. Hence, it suffices to show that  $\tor_{i+1}^S(E,k)_{(a,b)} =0 $ for $a+b\geq i+1$. Note that, $\Tor^S_{\star}(E,k)$ can be computed by the homologies of the Koszul complex $\textbf{K}_{\bullet}((\textbf{x},\textbf{y}),E )$, where $\textbf{x}= (x_1,\dots,x_n)$ and $\textbf{y}= (y_1,\dots, y_m)$. On the other hand, homologies of $\textbf{K}_{\bullet}((\textbf{x},\textbf{y}),E )$ is the total homologies of the double Koszul complex $\textbf{K}_{\bullet,\bullet}(\textbf{x};\textbf{y},E )$. Therefore,
\begin{align*}
\tor_{i+1}^S(E,k)_{(a,b)}&\cong H_{i+1}\textbf{K}_{\bullet}((\textbf{x},\textbf{y}),E )_{(a,b)}\\
&\cong H_{i+1}(\textbf{Tot}(\textbf{K}_{\bullet,\bullet}(\textbf{x};\textbf{y},E))_{(a,b)}.
\end{align*}
 In the spectral sequence, $\textbf{K}_{p,q}(\textbf{x};\textbf{y},E)_{(a,b)}\cong E(a-p,b-q)^{\binom{n}{p}\binom{m}{q}}$. Let 
 $$
 z\in Z_{i+1}(\textbf{Tot}(\textbf{K}_{\bullet,\bullet}(\textbf{x};\textbf{y},E))_{(a,b)}\subseteq  \oplus_{p+q=i+1}\textbf{K}_{p,q}(\textbf{x};\textbf{y},E)_{(a,b)}
 $$
  be a cycle. Decompose $z$ into  $z=z_1\oplus z_2$, where $ z_1\in \oplus_{
 p>a} \textbf{K}_{p,q}(\textbf{x};\textbf{y},E)_{(a,b)}$, $ z_2\in \oplus_{
 q>b} \textbf{K}_{p,q}(\textbf{x};\textbf{y},E)_{(a,b)}$ and $p+q=i+1$.
It is enough to show  that
$$
 z_1\oplus z_2 \in B_{i+1}(\textbf{Tot}(\textbf{K}_{\bullet,\bullet}(\textbf{x};\textbf{y},E)))_{(a,b)}.
 $$
Truncate $\textbf{K}_{p,q}$ where $p>a$ and denote it by $(\textbf{K}_{\bullet,\bullet}^{p>a})$ and denote the total complex by $(\textbf{K}^{p>a}_{\bullet}, \partial^{p>a})$. Note that
$$
\textbf{K}_{\bullet,\bullet}^{p>a}(\textbf{x};\textbf{y},E)_{(a,b)}\cong \textbf{K}_{\bullet,\bullet}^{p>a}(\textbf{x};\textbf{y},M)_{(a,b)}.
$$
Denote  the corresponding spectral sequence of $\textbf{K}_{\bullet,\bullet}^{p>a}(\textbf{x};\textbf{y},E)_{(a,b)}$ by $\mathcal{E}$, therefore
$ \mathcal{E}^1_{p,q}= 0$ for $p\leq a$, and if $p>a$ then 
$$
{\mathcal{E}^1_{p,q}}_{(a,b)}\cong \tor_q^S(M, k[\textbf{x}])_{(a-p,b)}^{\binom{n}{p}}.
$$
In particular, $(\mathcal{E}^1_{p,q})_{(a,b)}=0$ if  $b-q> b^y_q(M)-q$. This holds as $b-q>\reg^q_y(M)$. Indeed, $q\leq i$ since $p\geq 1$ and $b>q$ as $p+q\leq a+b$.
%\begin{align}
%H_{i+1}(\textbf{Tot}(\textbf{K}_{\bullet,\bullet}^{p>a}(E, \textbf{x};\textbf{y})))_{(a,b)} &\cong \oplus_{p>a} (\Tor^{k[\textbf{y}]}_{i+1-p}(M_{(a,\star)},k)(-p))_{(a,b)}\nonumber\\
% &\cong \oplus_{i+1-p}  \Tor^{k[\textbf{y}]}_{i+1-p}(M_{(a-p,\star)}, k)_{(a-p,b)}\nonumber\\
% &\cong 0 \qquad\label{equation}
%\end{align}
%The \ref{equation} follows from Lemma \ref{Lemma1} and $q-b\geq \reg_y(M)$.

Hence there exists $c_1\in \textbf{K}^{p>a}_{i+2}(\textbf{x};\textbf{y},E)_{(a,b)}$ such that $\partial^{p>a}(c_1)= z_1$. Write $c_1= \oplus_{p>a}c_{p,i+2-p} $;
$$
\partial(c_1)= \partial^{p>a}(c_1)+ \partial^x(c_{a+1,i+1-a}),
$$
where $\partial^x(c_{a+1,i+1-a})\in \textbf{K}_{a, i+1-a}(\textbf{x};\textbf{y},E)_{(a,b)}\cong {E_{(0, a+b-(i+1))}}^{\binom{n}{a}\binom{m}{i+1-a}}=0$ since $a+b\geq i+1$. The argument for $z_2$ is the same.
\end{proof}
\begin{example} In the following examples we show that both assumptions in Theorem \ref{r=2} are necessary.
\begin{itemize}
\item[$(1)$] The statement of Theorem \ref{r=2} does not hold if we have more sets of variables. \linebreak Let $ S = k[x_1,x_2,y_1,y_2,z_1,z_2]$ be a $\mathbb{Z}^3$-graded polynomial ring where $\deg(x_i)=(1,0,0)$, $\deg(y_i)= (0,1,0)$ and $\deg(z_i)=(0,0,1)$ for $i=0,1$, and 
  $$I = (x_1x_2y_1z_1^2, x_2^2y_1^2y_2^2z_1^2, x_1^3y_1z_2, x_1^2x_2y_2z_1z_2,
 x_1x_2^2y_2^2z_1^3, x_2^3y_1^2y_2z_2^2).
 $$
Although $\{4,3,2\}$ is equal to the partial regularities of $S/I$ and its total degree is greater than  $\reg(S/I)=9$, the truncation of $S/I$ at $(4,3,2)$ does not have a linear resolution. 

\item[$(2)$] Let $S=k[x_1,y_1,y_2]$, and $I= (x_1^2y_1, x_1y_2^2)$. The partial regularities of $S/I$ is $\{1,1\}$ and its total degree is smaller than $\reg (S/I)=3$.  One can see that the truncation of $S/I$ at $(1,1)$ does not have a linear resolution. Hence the assumption $\bar{\textbf{d}}\geq \reg(S/I)$ is necessary in Theorem \autoref{r=2}.

\end{itemize}
\end{example}

Proposition \autoref{prop EES} and Theorem \autoref{r=2} give a single degree in the linear truncations of $M$. In general, this degree could be far from the minimal generators. Because of that, we implemented $\mathtt{findAllLinearTruncation}$, which is useful to find all the minimal generators of linear truncations of $M$.


\begin{algorithm}[H]
\SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
 \Input{A module $M$ and a range $(a,b)$}
 \Output{Minimal generators of linear truncation with total degree between $a$ and $b$}
 $A,L:= \emptyset \subset \Z^r$\;
 \While{$a\leq i\leq b$}{
 \For {all $d\in \Z^r$ with $\bar{d}=i$} {  
  \If{$d\notin L$ and $M_{\geq d}$ has a linear resolution }{
 $L:= L\cup  (d+\Z^r)$\;
	$A:= A\cup \{d\}$\;
   }
 }
 }
 \Return { $A$.}
 \caption{Algorithm for implementing $\mathtt{findAllLinearTruncation}$}
\end{algorithm}
\section{Some Examples}
\noindent In this section, we provide some examples comparing the linear truncations in bigraded or single graded setting.  In the following example, the minimal generators of linear truncations have two different total degrees. 
  \begin{footnotesize}
 \begin{verbatim}
i0 : S=QQ[x_1..x_6,Degrees=>{{1,0,0},{1,0,0},{0,1,0},{0,1,0},{0,0,1},{0,0,1}}];
i1 : I=ideal(x_1*x_4*x_6,x_1*x_3^2,x_3^2*x_4*x_5,x_2^2*x_5^2,x_1*x_4^2*x_5,x_1*x_2^2*x_4);
i2 : M=S^1/I;
i3 : c=coarseMultigradedRegularity M
o3 = {3, 4, 2}
i4 : findAllLinearTruncations({regularity M, sum coarseMultigradedRegularity M}, M)
o4 = {{2, 2, 1}, {1, 3, 2}}
\end{verbatim}
\end{footnotesize}
\begin{question}
Let $S$ be multigraded polynomial ring and $M$ be a finitely generated  multigraded  $S$-module. Is it possible for a degree $\textbf{d}$ where $\bar{\textbf{d}}<\reg(M)$ to be in a linear truncations of $M$?
\end{question}
The answer to this question is yes.  Let $M$ be an Artinian module, the regularity of $M$ is equal to the maximum degree of the socle elements. On the other hand, truncating at each socle element has a linear resolution. Therefore it is possible to find that $\textbf{d}$ if the two socle elements of $M$ have different degrees. 

 Here is a simple example: 
\begin{footnotesize}
 \begin{verbatim}
i0 : S = QQ[x,y,Degrees=>{{1,0},{0,1}}];
i1 : I = ideal(x^3, x*y,y^7 );
i2 : M = S^1/I;
i3 : regularity M
o3 = 6
i4 : isLinearComplex (res truncate({2,0},M))
o4 = true
\end{verbatim}
\end{footnotesize}
We conclude the paper by presenting an example of  $96$ points in $\mathbb{P}^2\times \mathbb{P}^2$ forming a complete intersection\footnote{A subscheme $V \subset \mathbb{P}^n \times \mathbb{P}^m$, is a complete intersection if $V = \mathrm{Proj}(S/I)$ where $I$ is generated by $\mathrm{codim}(V)$ bihomogeneous elements.} that has more geometric meaning than previous Artinian example:

\begin{footnotesize}
 \begin{verbatim}
i0 : S = QQ[x_0,x_1,x_2,y_0,y_1,y_2,Degrees=>{{1,0},{1,0},{1,0},{0,1},{0,1},{0,1}}];
i1 : I = ideal(x_0^2*y_0^2,x_1^2*y_1^2,x_2^2*y_2^2,(x_0+x_1+x_2)^2*(y_0+y_1+y_2)^2);
i2 : B = intersect(ideal(x_0,x_1,x_2), ideal(y_0, y_1,y_2));
i3 : J = saturate (I,B);
i4 : M = S^1/J;
i5 : regularity M
o5 = 11
i6 : findAllLinearTruncations({0,11},M)
o6 = {{2, 6}, {6, 2}}
\end{verbatim}
\end{footnotesize}
This  is also interesting because the linear truncations of $M$ is not a convex set. In addition, if we look at the bigraded Hilbert function of $M$:
\begin{footnotesize}
 \begin{verbatim}
i7 :  matrix for i to 10 list for j to 10 list hilbertFunction({j,i},M)
o7 = | 1  3  6  10 15 21 24 24 24 |
     | 3  9  18 30 45 63 72 72 72 |
     | 6  18 32 48 66 86 96 96 96 |
     | 10 30 48 64 78 90 96 96 96 |
     | 15 45 66 78 87 93 96 96 96 |
     | 21 63 86 90 93 95 96 96 96 |
     | 24 72 96 96 96 96 96 96 96 |
     | 24 72 96 96 96 96 96 96 96 |
     | 24 72 96 96 96 96 96 96 96 |
\end{verbatim}
\end{footnotesize}
and applying Proposition 6.7 in \cite{MaclagenSmith}, the multigraded regularity and the linear truncations of $M$ coincide.


\section{Acknowledgment}
The authors would like to thank the organizers of the Macaulay2 workshop(June 2018) in Leipzig during which the algorithms were first implemented. The second author would like to thank Marc Chardin for his useful comments.


\bibliographystyle{alpha}
\bibliography{bib.bib}

\end{document}  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               